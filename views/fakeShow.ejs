<%- include('./partials/header')%>
<body>
    <%- include('./partials/preloader')%>
    <%- include('./partials/flasher')%>
    <%- include('./partials/navbar')%>

    <style>
        #map { top: 0; bottom: 0; height: 700px ;width: 80% ;margin-left: 20px;margin-top: 50px;border-style:outset;}
    </style>


    <style>
        #foodpostCarousel{
            margin-left: auto;
            margin-right: auto;
            display:block;
            width:50%
        }

    </style>
    <div id="foodpostCarousel" class="carousel slide" data-ride="carousel">
        <div class="carousel-inner">
            <% for (var x = 0; x< singleFoodPost.images.length ; x++){ %>
                <% if(x==0){ %>
                    <div class="carousel-item active">
                        <img src="<%= singleFoodPost.images[x].url %>" class="d-block w-100" alt="...">
                    </div>
                <% }else{ %>
                    <div class="carousel-item">
                        <img src="<%= singleFoodPost.images[x].url %>" class="d-block w-100" alt="...">
                    </div>
                <%}%>
            <%} %>
     
        </div>
        <% if(singleFoodPost.images.length > 1) {%>
        <a class="carousel-control-prev" href="#foodpostCarousel" role="button" data-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="sr-only">Previous</span>
        </a>
        <a class="carousel-control-next" href="#foodpostCarousel" role="button" data-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="sr-only">Next</span>
        </a>
        <% } %>
    </div>
    



    
    <div id="map"></div>
    <h1>My name is <%= singleFoodPost.name %></h1>
    <h1>By <a href="/profile/<%= singleFoodPost.writer._id %>"><%= singleFoodPost.writer.username %></a></h1>
    <h2>Location: <%= singleFoodPost.location %></h2>
    <h2>Description: <%= singleFoodPost.description %></h2>


    <% if (singleFoodPost.writer){ %>
        <%  if( currentUser && singleFoodPost.writer.equals(currentUser._id))  {%>
            <div class="card-body">
                <a href="/foodposts/<%=singleFoodPost._id%>/edit">Edit foodpost</a>
                <form class="d-inline" action="/foodposts/<%=singleFoodPost._id%>?_method=DELETE" method="POST">
                    <button class="btn btn-danger">Delete This post</button>
                </form>
            </div>
        <% } %>
    <% } %>
    



    <br>
    <h2>Reviews Section</h2>


    <% for(let review of singleFoodPost.reviews){ %>
        <p><%= review.body %></p>
        <% if (review.reviewer){ %>
            <%  if( currentUser && review.reviewer.equals(currentUser._id))  {%> 
                <form action="/foodposts/<%=singleFoodPost._id%>/reviews/<%=review._id%>?_method=DELETE" method="POST">
                    <button class="btn btn-sm btn-danger">Delete</button>
                </form>
            <% } %>
        <% } %>
    <% }%>

    <% if(currentUser){ %>
    <form action="/foodposts/<%= singleFoodPost._id %>/reviews" class="validated-form" method = "POST">
        <div class="form-row">
            <div class="col-md-4 mb-3">
                <label for="description">Description</label>
                <input type="text" class="form-control" id="description" name = "review[body]" placeholder="Description" required>
                <div class="valid-feedback">
                  Looks good!
                </div>
            </div>
        </div> 
        <button class="btn btn-primary" type="submit">Submit review</button>
 
    </form>
    <% } %>

    
    
    <!-- ======================================================================================================================================== -->
    <script>
        const MapBoxToken = "<%- process.env.MAPBOX_API_TOKEN %>"
        const destination = [<%= singleFoodPost.geometry.coordinates[0] %>,<%= singleFoodPost.geometry.coordinates[1] %>]
    </script>
    <script src="/jsfiles/showMapbox.js"></script>
    <!-- ======================================================================================================================================== -->

    
    

<%- include('./partials/footer')%>
